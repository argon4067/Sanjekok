{% extends "member/mypage_base.html" %}
{% load static %}
{% block title %}산재 관리 | 산재콕{% endblock %}

{% block script1 %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'CSS/member/mypage_individual_list.css' %}">
<script>
document.addEventListener("DOMContentLoaded", function() {
  const selectAllCheckbox = document.getElementById('select-all');
  if (!selectAllCheckbox) return;

  const itemCheckboxes = document.querySelectorAll('input[name="selected_ids"]');

  selectAllCheckbox.addEventListener('change', function() {
    itemCheckboxes.forEach(checkbox => {
      checkbox.checked = this.checked;
    });
  });

  itemCheckboxes.forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      if (!this.checked) {
        selectAllCheckbox.checked = false;
      } else {
        const allChecked = Array.from(itemCheckboxes).every(item => item.checked);
        if (allChecked) selectAllCheckbox.checked = true;
      }
    });
  });
});
</script>
{% endblock %}

{% block mypage_contents %}
<div class="mypage-wrapper">
  <div class="mypage-card">
    <div class="mypage-header">
      <h2>산재 정보 관리</h2>
      <p>등록된 산재 정보를 확인하고 수정 또는 삭제할 수 있습니다.</p>
    </div>

    <div class="mypage-body">
      {% if individuals %}
      <form method="post" action="{% url 'Member:mypage_individual_bulk_delete' %}">
        {% csrf_token %}
        <div class="table-wrap">
          <table class="custom-table">
            <thead>
              <tr>
                <th><input type="checkbox" id="select-all" title="전체 선택"></th>
                <th>번호</th>
                <th>제목</th>
                <th>업종</th>
                <th>발생형태</th>
                <th>질병</th>
                <th>재해일자</th>
                <th>주소</th>
              </tr>
            </thead>
            <tbody>
              {% for individual in individuals %}
              <tr>
                <td><input type="checkbox" name="selected_ids" value="{{ individual.accident_id }}"></td>
                <td>{{ forloop.counter }}</td>
                <td>{{ individual.i_title }}</td>
                <td>{{ individual.member_industry.i_industry_type2 }}</td>
                <td>{{ individual.i_disease_type|default:"-" }}</td>
                <td>{{ individual.i_injury|default:"-" }}</td>
                <td>{{ individual.i_accident_date }}</td>
                <td>{{ individual.i_address }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="btn-group-center">
          <a href="{% url 'Member:mypage_individual_add' %}" class="btn-primary">산재 정보 추가</a>
          <button type="submit" class="btn-danger">선택 항목 삭제</button>
        </div>
      </form>
      {% else %}
      <div class="text-center empty-wrap">
        <p>등록된 산재 정보가 없습니다.</p>
        <a href="{% url 'Member:mypage_individual_add' %}" class="btn-primary">산재 정보 추가</a>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock mypage_contents %}
