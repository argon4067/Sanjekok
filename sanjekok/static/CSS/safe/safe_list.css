{% extends "base.html" %}
{% load static %}

{% block title %}ì•ˆì „ìë£Œì‹¤{% endblock %}

{% block script1 %}
<link rel="stylesheet" href="{% static 'CSS/safe/safe_list.css' %}">
<script src="{% static 'js/safe/safe.js' %}"></script>
{% endblock %}

{% block contents %}
<section class="safe-section">
  <div class="container py-5">

    <!-- ì œëª© -->
    <div class="safe-header text-center mb-4">
      <p class="subtitle">ì‚°ì—…ì•ˆì „ ê´€ë ¨ ìë£Œë¥¼ í•œê³³ì—</p>
      <h2 class="fw-bold">ì•ˆì „ìë£Œì‹¤</h2>
    </div>

    <!-- ìµœê·¼ ë³¸ ìë£Œ -->
    {% if recent_list %}
    <div class="recent-section mb-5">
      <h4 class="section-title">ìµœê·¼ ë³¸ ìë£Œ</h4>
      <div class="recent-slider-wrapper">
        <button class="slider-btn prev" type="button">&lt;</button>
        <div class="recent-slider">
          {% for h in recent_list %}
          <a href="{% url 'Safe:safe_detail' h.safe.id %}" class="recent-card">
            <img src="{{ h.safe.s_image_url }}" alt="ìë£Œ ì´ë¯¸ì§€">
            <p class="recent-title">{{ h.safe.s_title }}</p>
          </a>
          {% endfor %}
        </div>
        <button class="slider-btn next" type="button">&gt;</button>
      </div>
    </div>
    {% endif %}

    <!-- í•„í„° -->
    <form method="get" id="filterForm" class="filter-wrapper shadow-sm">
      <div class="filter-group">
        <div class="filter-label">ìë£Œìœ í˜•</div>
        <div class="filter-controls">
          {% for val in type_list %}
          <label class="cb-label">
            <input type="checkbox" name="type" value="{{ val }}" {% if val in selected_types %}checked{% endif %}>
            {{ val }}
          </label>
          {% endfor %}
        </div>
      </div>

      <div class="filter-group">
        <div class="filter-label">ì–¸ì–´</div>
        <div class="filter-controls">
          {% for lang in language_list %}
          <label class="cb-label">
            <input type="checkbox" name="lang" value="{{ lang }}" {% if selected_language == lang %}checked{% endif %}>
            {{ lang }}
          </label>
          {% endfor %}
        </div>
      </div>

      <div class="filter-group">
        <div class="filter-label">ê²€ìƒ‰</div>
        <div class="filter-controls search-box">
          <input type="text" name="q" class="form-control search-input" placeholder="ì œëª©ê²€ìƒ‰" value="{{ search_keyword }}">
          <button type="submit" class="btn btn-outline-secondary btn-search">ê²€ìƒ‰</button>
        </div>
      </div>
    </form>

    <!-- ì •ë ¬ -->
    <form method="get" id="sortForm" class="sort-wrapper">
      {% for key, value in request.GET.items %}
        {% if key != "sort" %}
          <input type="hidden" name="{{ key }}" value="{{ value }}">
        {% endif %}
      {% endfor %}
      <div class="sort-label">ì •ë ¬:</div>
      <div class="filter-controls">
        <select name="sort" class="form-select sort-select" onchange="this.form.submit()">
          <option value="latest"{% if sort == "latest" %} selected{% endif %}>ìµœì‹ ìˆœ</option>
          <option value="oldest"{% if sort == "oldest" %} selected{% endif %}>ê³¼ê±°ìˆœ</option>
          <option value="views"{% if sort == "views" %} selected{% endif %}>ì¡°íšŒìˆœ</option>
        </select>
      </div>
    </form>

    <!-- ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ -->
    <div class="safe-card-list">
      {% for s in list %}
      <a href="{% url 'Safe:safe_detail' s.id %}" class="safe-card">
        <div class="card-left">
          <h3 class="card-title">{{ s.s_title }}</h3>
          <div class="card-tags">
            {% for t in s.tags.all %}
              <span>#{{ t.st_tag }}</span>
            {% endfor %}
          </div>
          <p class="card-desc">{{ s.s_contents|truncatechars:100 }}</p>
        </div>
        <div class="card-right">
          {% if s.s_image_url %}
            <img src="{{ s.s_image_url }}" class="card-img">
          {% else %}
            <div class="card-noimg">NO IMAGE</div>
          {% endif %}
        </div>
      </a>
      {% empty %}
      <p class="text-center mt-5">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
      {% endfor %}
    </div>

    <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
    <div class="mt-5">
      <ul class="pagination justify-content-center">
        {% if list.has_previous %}
        <li class="page-item"><a class="page-link" href="?{% if querystring %}{{ querystring }}&{% endif %}page=1">ì²˜ìŒ</a></li>
        <li class="page-item"><a class="page-link" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ list.previous_page_number }}">ì´ì „</a></li>
        {% endif %}
        {% for i in page_range %}
          {% if list.number == i %}
            <li class="page-item active"><span class="page-link">{{ i }}</span></li>
          {% else %}
            <li class="page-item"><a class="page-link" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ i }}">{{ i }}</a></li>
          {% endif %}
        {% endfor %}
        {% if list.has_next %}
        <li class="page-item"><a class="page-link" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ list.next_page_number }}">ë‹¤ìŒ</a></li>
        <li class="page-item"><a class="page-link" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ list.paginator.num_pages }}">ë</a></li>
        {% endif %}
      </ul>
    </div>

  </div>
</section>
{% endblock %}



/* ===========================
   1. ê¸°ë³¸ ë°°ê²½/í°íŠ¸
=========================== */
body {
  background-color: #f6f8f7;
  font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
  color: #23333d;
}

/* ===========================
   2. ì œëª© ì˜ì—­
=========================== */
.safe-header .subtitle {
  color: #f99b18;
  font-weight: 600;
  font-size: 1rem;
  margin-bottom: 8px;
}

.safe-header h2 {
  color: #23333d;
  font-weight: 700;
  font-size: 1.9rem;
}

/* ===========================
   3. í•„í„° ë°•ìŠ¤
=========================== */
.filter-wrapper {
  background: #ffffff;
  border: 1px solid #e3e6ea;
  border-radius: 14px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  padding: 24px 28px;
  margin-bottom: 30px;
}

.filter-group {
  display: flex;
  align-items: center;
  margin-bottom: 14px;
}

.filter-label {
  width: 90px;
  font-weight: 700;
  color: #23333d;
}

.filter-controls {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.cb-label {
  font-size: 0.95rem;
}

.search-box {
  display: flex;
  gap: 10px;
}

.search-input {
  width: 320px;
  border-radius: 8px;
}

/* ===========================
   4. ì •ë ¬ ë“œë¡­ë‹¤ìš´
=========================== */
.sort-wrapper {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 10px;
  margin-bottom: 25px;
}

.sort-select {
  width: 120px;
  border-radius: 8px;
}

/* ===========================
   5. ì¹´ë“œí˜• ìë£Œ ë¦¬ìŠ¤íŠ¸
=========================== */
.safe-card-list {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.safe-card {
  background: #fff;
  border: 1px solid #e3e6ea;
  border-radius: 14px;
  padding: 20px 24px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
  text-decoration: none;
  color: inherit;
  transition: all 0.25s ease;
  border-left: 4px solid #f99b18;
}

.safe-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
}

/* ì¹´ë“œ ì™¼ìª½ */
.card-left {
  flex: 1;
  padding-right: 16px;
}

.card-title {
  font-size: 1.1rem;
  font-weight: 700;
  margin-bottom: 8px;
}

.card-tags span {
  display: inline-block;
  background: #edf1f5;
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 13px;
  margin-right: 5px;
  color: #58616c;
}

.card-desc {
  margin-top: 10px;
  font-size: 15px;
  color: #5c636a;
}

/* ì¹´ë“œ ì˜¤ë¥¸ìª½ ì´ë¯¸ì§€ */
.card-right {
  width: 140px;
  height: 120px;
  border-radius: 8px;
  overflow: hidden;
  background: #f1f3f4;
}

.card-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.card-noimg {
  display: flex;
  align-items: center;
  justify-content: center;
  color: #aaa;
  font-size: 13px;
}

/* ================================
  í˜ì´ì§€ë„¤ì´ì…˜ (ì‚°ì¬ë‰´ìŠ¤ ë™ì¼)
================================ */
.pagination {
  margin-top: 40px;
  justify-content: center;
}

.pagination .page-link {
  border: none;
  background-color: transparent;
  color: #23333d;
  font-weight: 500;
  padding: 6px 12px;
  margin: 0 3px;
  border-radius: 8px;
  transition: all 0.25s ease;
}

.pagination .page-link:hover {
  background-color: #f99b18;
  color: #fff;
}

.pagination .page-item.active .page-link {
  background-color: #23333d;
  color: #fff !important;
  font-weight: 700;
}

.safe-section {
  min-height: calc(100vh - 300px);
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
}

/* ================================
   ğŸ§­ ìµœê·¼ ë³¸ ìë£Œ ìŠ¬ë¼ì´ë” (ë¦¬ë‰´ì–¼)
================================ */
.recent-section {
  margin: 60px auto;
  text-align: center;
  width: 100%;
  max-width: 1100px;
}

.section-title {
  font-size: 1.2rem;
  font-weight: 700;
  color: #23333d;
  margin-bottom: 20px;
}

/* ìŠ¬ë¼ì´ë” ì „ì²´ ì˜ì—­ */
.recent-slider-wrapper {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
}

/* ì¢Œìš° ë²„íŠ¼ */
.slider-btn {
  background-color: #ffffff;
  border: 1px solid #dcdfe3;
  color: #23333d;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.25s ease;
  font-weight: 700;
}
.slider-btn:hover {
  background-color: #f99b18;
  color: #fff;
}

/* ìŠ¬ë¼ì´ë“œ ë‚´ë¶€ */
.recent-slider {
  display: flex;
  gap: 20px;
  overflow: hidden;
  width: 850px;
  scroll-behavior: smooth;
}

/* ì¹´ë“œ ê°œë³„ */
.recent-card {
  flex: 0 0 300px;
  background: #fff;
  border: 1px solid #e3e6ea;
  border-radius: 10px;
  text-decoration: none;
  color: #23333d;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
  transition: all 0.25s ease;
}
.recent-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
}

/* ì¹´ë“œ ì´ë¯¸ì§€ */
.recent-card img {
  width:100%;
  height: 300px;
  object-fit: cover;
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
}

/* ì œëª© */
.recent-title {
  padding: 10px;
  font-size: 0.9rem;
  font-weight: 600;
  color: #23333d;
  text-align: center;
  line-height: 1.4;
  height: 42px;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ===========================
   7. ë°˜ì‘í˜•
=========================== */
@media (max-width: 768px) {
  .safe-card {
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  .card-right {
    width: 100%;
    max-width: 250px;
    height: 160px;
    margin-top: 12px;
  }
  .filter-wrapper {
    padding: 16px;
  }
  .search-input {
    width: 100%;
  }
  .recent-slider {
    width: 100%;
    overflow-x: auto;
    padding: 0 10px;
  }
  .recent-card {
    flex: 0 0 200px;
  }
  .recent-card img {
    height: 140px;
  }
  .slider-btn {
    display: none;
  }
}




